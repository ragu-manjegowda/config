#!/usr/bin/env bash

# Extended display with scaled external monitor to match laptop height
# This makes cursor movement smooth across displays
# Configuration is read from config.lua via read-display-config

# Source the configuration from config.lua
source <("$HOME/.config/awesome/utilities/read-display-config")

# Set DPI based on configuration
xrandr --dpi "$DISPLAY_DPI"

# Set laptop display (primary)
xrandr --output "$PRIMARY_NAME" --primary --mode "$PRIMARY_MODE" --pos "$PRIMARY_POS"

# Check if external monitor is connected
if xrandr | grep -q "^${EXTERNAL_NAME} connected"; then
    # Build external monitor command
    EXTERNAL_CMD="xrandr --output $EXTERNAL_NAME --mode $EXTERNAL_MODE --pos $EXTERNAL_POS"

    # Add scaling if configured
    if [ -n "$EXTERNAL_SCALE_FROM" ]; then
        EXTERNAL_CMD="$EXTERNAL_CMD --scale-from $EXTERNAL_SCALE_FROM"
    fi

    # Apply external monitor settings
    eval "$EXTERNAL_CMD"

    echo "âœ“ Extended display configured:"
    echo "  - Primary ($PRIMARY_NAME): $PRIMARY_MODE @ $PRIMARY_POS"
    echo "  - External ($EXTERNAL_NAME): $EXTERNAL_MODE @ $EXTERNAL_POS"
    [ -n "$EXTERNAL_SCALE_FROM" ] && echo "  - Scaling: from $EXTERNAL_SCALE_FROM"
    echo "  - DPI: $DISPLAY_DPI"
else
    echo "$EXTERNAL_NAME not connected, using $PRIMARY_NAME only"
fi

